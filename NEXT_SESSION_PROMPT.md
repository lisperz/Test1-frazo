# Next Session Context - Railway Deployment Status

**Last Updated**: December 5, 2025
**Current Status**: ‚úÖ **FULLY DEPLOYED AND WORKING**

---

## üöÄ Railway Deployment - Current State

### ‚úÖ All Services Running

| Service | URL | Status |
|---------|-----|--------|
| Backend API | https://backend-production-268a.up.railway.app | ‚úÖ Running |
| Frontend | https://frontend-production-b02b.up.railway.app | ‚úÖ Running |
| PostgreSQL | Internal Railway connection | ‚úÖ Connected |
| Redis | Internal Railway connection | ‚úÖ Connected |
| Worker (Celery) | Internal | ‚úÖ Running |
| Beat (Scheduler) | Internal | ‚úÖ Running |

### ‚úÖ Features Working

1. **User Authentication**: Login/logout with JWT tokens
2. **Normal Video Editor**: `/editor` - Lip-sync + text removal
3. **Pro Video Editor**: `/editor/pro` - Advanced segments-based lip-sync
4. **GhostCut Integration**: Text removal API working
5. **Sync.so Integration**: Lip-sync API working
6. **AWS S3**: File uploads working

---

## üîë Demo Credentials

| Email | Password | Role |
|-------|----------|------|
| demo@example.com | demo123 | User |
| boss@example.com | boss123 | Admin |

---

## üìÅ Key Files Reference

### Backend API Routes
- **Normal Video Editor API**: `backend/api/routes/video_editors/sync/sync_api_original.py`
  - Endpoint: `POST /api/v1/video-editors/sync-process`
  - Uses `settings.sync_api_key` for Sync.so API

- **Pro Video Editor API**: `backend/api/routes/video_editors/sync/routes.py`
  - Endpoint: `POST /api/v1/video-editors/pro-sync-process`
  - Uses `settings.sync_api_key` for Sync.so API

- **GhostCut (Text Removal)**: `backend/api/routes/jobs/processing/direct_process_original.py`
  - Endpoint: `POST /api/v1/jobs/direct-process`

### Frontend Components
- **API Constants**: `frontend/src/components/VideoEditor/GhostCut/constants/editorConstants.ts`
  - Uses dynamic `getApiBaseUrl()` for both local and production

- **Video Editor**: `frontend/src/components/VideoEditor/GhostCutVideoEditor.tsx`
  - Uses `API_ENDPOINTS.SYNC_PROCESS` for normal editor

### Configuration
- **Backend Settings**: `backend/config.py`
  - `sync_api_key`: Sync.so API key
  - `ghostcut_api_key`, `ghostcut_app_secret`, etc.

---

## üåê Environment Variables

### Backend (Railway)
```
DATABASE_URL=<auto-generated>
REDIS_URL=<auto-generated>
JWT_SECRET_KEY=<secret>
GHOSTCUT_API_KEY=fb518b019d3341e2a3a32e730d0797c9
GHOSTCUT_APP_SECRET=fcbc542efcb44a198dd53c451503fd04
GHOSTCUT_APP_KEY=fb518b019d3341e2a3a32e730d0797c9
GHOSTCUT_UID=b48052d4449f46a3b4654473c41a2a6a
GHOSTCUT_API_URL=https://api.zhaoli.com
SYNC_API_KEY=sk-JkRdjIsaTKW-5-fPn0ig2A.8BEgEdZlcKdH9Jx_YDfl2KrShFW8OxMC
SYNC_API_URL=https://api.sync.so
AWS_ACCESS_KEY_ID=<configured>
AWS_SECRET_ACCESS_KEY=<configured>
AWS_S3_BUCKET=<configured>
AWS_REGION=us-east-1
ENVIRONMENT=production
```

### Frontend (Railway - Build-time)
```
REACT_APP_API_URL=https://backend-production-268a.up.railway.app/api/v1
```

---

## üß™ Quick Test Commands

```bash
# Health check
curl https://backend-production-268a.up.railway.app/health

# Check services configuration
curl https://backend-production-268a.up.railway.app/api/v1/debug/check-services

# Test login
curl -X POST https://backend-production-268a.up.railway.app/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"demo@example.com","password":"demo123"}'
```

---

## üìö Railway CLI Reference

```bash
# View logs
railway logs --service backend
railway logs --service worker
railway logs --service frontend

# Deploy manually
railway up --service backend --detach
railway up --service frontend --detach

# Check status
railway status
```

---

## ‚ö†Ô∏è Important Notes

1. **Frontend Environment Variables**: React embeds env vars at BUILD TIME. After changing `REACT_APP_*` variables, you must trigger a rebuild:
   ```bash
   railway up --service frontend --detach
   ```

2. **Sync.so API Credits**: If jobs fail with "free credit limit exceeded", the Sync.so account needs more credits at https://sync.so/billing/subscription

3. **Both video editors share the same API key**: Normal editor (`sync_api_original.py`) and Pro editor both use `settings.sync_api_key`

---

## üéØ Recent Session Summary (December 5, 2025)

### Issues Fixed
1. ‚úÖ **405 Method Not Allowed**: Frontend was calling relative API paths that hit nginx. Fixed by using dynamic `getApiBaseUrl()` in `editorConstants.ts`

2. ‚úÖ **404 Not Found on sync-process**: Normal video editor endpoint wasn't registered. Fixed by importing `sync_api_original.py` in `backend/api/routes/video_editors/sync/__init__.py`

3. ‚úÖ **Import Errors**: Fixed broken imports in `sync_api_original.py`:
   - `from backend.services.s3 import s3_service`
   - `from backend.api.routes.jobs.processing.direct_process_original import check_ghostcut_status_async`

4. ‚úÖ **Sync.so API Key**: Normal editor was using hardcoded expired API key. Fixed to use `settings.sync_api_key` (same as Pro editor)

### Files Modified
- `frontend/src/components/VideoEditor/GhostCut/constants/editorConstants.ts`
- `frontend/src/components/VideoEditor/GhostCutVideoEditor.tsx`
- `backend/api/routes/video_editors/sync/__init__.py`
- `backend/api/routes/video_editors/sync/sync_api_original.py`

---

## üöÄ Everything is Working!

The application is fully deployed and functional. Both normal and pro video editors are working with:
- Lip-sync processing via Sync.so
- Text removal via GhostCut
- File uploads via AWS S3
